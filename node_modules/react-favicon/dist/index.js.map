{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["'use strict'\n\nconst React = require('react')\nconst PropTypes = require('prop-types')\n\nconst faviconSize = 16\nlet linkEl\n\nfunction drawIcon({ url: src, alertCount: num, callback: cb, renderOverlay }) {\n  const img = document.createElement('img')\n  img.crossOrigin = 'Anonymous'\n  img.onload = function () {\n    const canvas = document.createElement('canvas')\n    canvas.width = faviconSize\n    canvas.height = faviconSize\n\n    const context = canvas.getContext('2d')\n    context.clearRect(0, 0, img.width, img.height)\n    context.drawImage(img, 0, 0, canvas.width, canvas.height)\n\n    if (num) {\n      const top = canvas.height - 9\n      const left = canvas.width - 7 - 1\n      const bottom = faviconSize\n      const right = faviconSize\n      const radius = 2\n\n      context.fillStyle = '#F03D25'\n      context.strokeStyle = '#F03D25'\n      context.lineWidth = 1\n\n      context.beginPath()\n      context.moveTo(left + radius, top)\n      context.quadraticCurveTo(left, top, left, top + radius)\n      context.lineTo(left, bottom - radius)\n      context.quadraticCurveTo(left, bottom, left + radius, bottom)\n      context.lineTo(right - radius, bottom)\n      context.quadraticCurveTo(right, bottom, right, bottom - radius)\n      context.lineTo(right, top + radius)\n      context.quadraticCurveTo(right, top, right - radius, top)\n      context.closePath()\n      context.fill()\n\n      context.font = 'bold 10px arial'\n      context.fillStyle = '#FFF'\n      context.textAlign = 'right'\n      context.textBaseline = 'top'\n      context.fillText(num, 15, 6)\n    }\n    if (renderOverlay) {\n      renderOverlay(canvas, context)\n    }\n\n    cb(null, context.canvas.toDataURL())\n  }\n  img.src = src\n}\n\nclass Favicon extends React.Component {\n  static displayName = 'Favicon'\n\n  static mountedInstances = []\n\n  static getActiveInstance() {\n    return Favicon.mountedInstances[Favicon.mountedInstances.length - 1]\n  }\n\n  static draw() {\n    if (typeof document === 'undefined') return\n\n    var activeInstance = Favicon.getActiveInstance()\n    if (typeof linkEl === 'undefined') {\n      var head = document.getElementsByTagName('head')[0]\n      linkEl = document.createElement('link')\n      linkEl.type = 'image/x-icon'\n      linkEl.rel = 'icon'\n\n      // remove existing favicons\n      var links = head.getElementsByTagName('link')\n      for (var i = links.length; --i >= 0; ) {\n        if (\n          /\\bicon\\b/i.test(links[i].getAttribute('rel')) &&\n          !activeInstance.props.keepIconLink(links[i])\n        ) {\n          head.removeChild(links[i])\n        }\n      }\n\n      head.appendChild(linkEl)\n    }\n\n    var currentUrl\n\n    if (activeInstance.props.url instanceof Array) {\n      currentUrl = activeInstance.props.url[activeInstance.state.animationIndex]\n    } else {\n      currentUrl = activeInstance.props.url\n    }\n\n    if (activeInstance.props.alertCount || activeInstance.props.renderOverlay) {\n      drawIcon({\n        alertCount: activeInstance.props.alertCount,\n        callback: (_, url) => {\n          linkEl.href = url\n        },\n        renderOverlay: activeInstance.props.renderOverlay,\n        url: currentUrl,\n      })\n    } else {\n      linkEl.href = currentUrl\n    }\n  }\n\n  static update() {\n    if (typeof document === 'undefined') return\n\n    var activeInstance = Favicon.getActiveInstance()\n    var isAnimated =\n      activeInstance.props.url instanceof Array && activeInstance.props.animated\n\n    // clear any running animations\n    var intervalId = null\n    clearInterval(activeInstance.state.animationLoop)\n\n    if (isAnimated) {\n      var animateFavicon = function animateFavicon() {\n        var nextAnimationIndex =\n          (activeInstance.state.animationIndex + 1) %\n          activeInstance.props.url.length\n        Favicon.draw()\n        activeInstance.setState({ animationIndex: nextAnimationIndex })\n      }\n      intervalId = setInterval(\n        animateFavicon,\n        activeInstance.props.animationDelay\n      )\n      animateFavicon()\n    } else {\n      Favicon.draw()\n    }\n\n    activeInstance.setState({ animationLoop: intervalId })\n  }\n\n  state = {\n    animationIndex: 0,\n    animationLoop: null,\n    animationRunning: false,\n  }\n\n  componentDidMount() {\n    Favicon.mountedInstances.push(this)\n    Favicon.update()\n  }\n\n  componentWillUnmount() {\n    var activeInstance = Favicon.getActiveInstance()\n    clearInterval(activeInstance.state.animationLoop)\n  }\n\n  componentDidUpdate(prevProps) {\n    if (\n      prevProps.url === this.props.url &&\n      prevProps.animated === this.props.animated &&\n      prevProps.alertCount === this.props.alertCount &&\n      prevProps.renderOverlay === this.props.renderOverlay &&\n      prevProps.keepIconLink === this.props.keepIconLink\n    )\n      return\n\n    Favicon.update()\n  }\n\n  render() {\n    return null\n  }\n}\n\nFavicon.defaultProps = {\n  alertCount: null,\n  animated: true,\n  animationDelay: 500,\n  keepIconLink: () => false,\n  renderOverlay: null,\n  url: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.string),\n    PropTypes.string,\n  ]).isRequired,\n}\n\nFavicon.propTypes = {\n  alertCount: PropTypes.number,\n  animated: PropTypes.bool,\n  animationDelay: PropTypes.number,\n  keepIconLink: PropTypes.func,\n  renderOverlay: PropTypes.func,\n}\n\nmodule.exports = Favicon\n"],"names":["React","require","PropTypes","faviconSize","linkEl","drawIcon","src","url","num","alertCount","cb","callback","renderOverlay","img","document","createElement","crossOrigin","onload","canvas","width","height","context","getContext","clearRect","drawImage","top","left","bottom","right","radius","fillStyle","strokeStyle","lineWidth","beginPath","moveTo","quadraticCurveTo","lineTo","closePath","fill","font","textAlign","textBaseline","fillText","toDataURL","Favicon","state","animationIndex","animationLoop","animationRunning","getActiveInstance","mountedInstances","length","draw","activeInstance","head","getElementsByTagName","type","rel","links","i","test","getAttribute","props","keepIconLink","removeChild","appendChild","currentUrl","Array","_","href","update","isAnimated","animated","intervalId","clearInterval","animateFavicon","nextAnimationIndex","setState","setInterval","animationDelay","componentDidMount","push","componentWillUnmount","componentDidUpdate","prevProps","render","Component","displayName","defaultProps","oneOfType","arrayOf","string","isRequired","propTypes","number","bool","func","module","exports"],"mappings":"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"}